{"visual":{"name":"crossTab","displayName":"CrossTab","guid":"PBI_CV_522F2011_DD5A_44D2_A8ED_456F3931DF77_DEBUG","visualClassName":"CrossTab","version":"1.0.0","description":"","supportUrl":"","gitHubUrl":""},"apiVersion":"1.1.0","author":{"name":"","email":""},"assets":{"icon":"assets/icon.png"},"externalJS":[],"style":"style/visual.less","capabilities":{"dataRoles":[{"name":"YAxis","kind":0,"displayName":"Y-Axis"},{"name":"XAxis","kind":0,"displayName":"X-Axis"},{"name":"Values","kind":1,"displayName":"Values"},{"name":"OverrideDimension","kind":1,"displayName":"Override Dimension"},{"name":"BorderDimension","kind":1,"displayName":"Border Dimension"},{"name":"TimelineDimension","kind":1,"displayName":"Timeline Dimension"}],"dataViewMappings":[{"conditions":[],"categorical":{"categories":{"for":{"in":"XAxis"}},"values":{"group":{"by":"YAxis","select":[{"for":{"in":"Values"}},{"for":{"in":"OverrideDimension"}},{"for":{"in":"BorderDimension"}},{"for":{"in":"TimelineDimension"}}]},"dataReductionAlgorithm":{"top":{}}}}}],"objects":{"general":{"displayName":"General","properties":{"color1":{"type":{"fill":{"solid":{"color":true}}},"displayName":"Colour 1"},"color1Val":{"type":{"numeric":true},"displayName":"Colour 1 Value"},"color2":{"type":{"fill":{"solid":{"color":true}}},"displayName":"Colour 2"},"color2Val":{"type":{"numeric":true},"displayName":"Colour 2 Value"},"color3":{"type":{"fill":{"solid":{"color":true}}},"displayName":"Colour 3"},"color3Val":{"type":{"numeric":true},"displayName":"Colour 3 Value"},"color4":{"type":{"fill":{"solid":{"color":true}}},"displayName":"Colour 4"},"color4Val":{"type":{"numeric":true},"displayName":"Colour 4 Value"},"color5":{"type":{"fill":{"solid":{"color":true}}},"displayName":"Colour 5"},"color5Val":{"type":{"numeric":true},"displayName":"Colour 5 Value"},"color6":{"type":{"fill":{"solid":{"color":true}}},"displayName":"Colour 6"},"color6Val":{"type":{"numeric":true},"displayName":"Colour 6 Value"},"color7":{"type":{"fill":{"solid":{"color":true}}},"displayName":"Colour 7"},"color7Val":{"type":{"numeric":true},"displayName":"Colour 7 Value"},"color8":{"type":{"fill":{"solid":{"color":true}}},"displayName":"Colour 8"},"color8Val":{"type":{"numeric":true},"displayName":"Colour 8 Value"},"color9":{"type":{"fill":{"solid":{"color":true}}},"displayName":"Colour 9"},"color9Val":{"type":{"numeric":true},"displayName":"Colour 9 Value"},"color10":{"type":{"fill":{"solid":{"color":true}}},"displayName":"Colour 10"},"color10Val":{"type":{"numeric":true},"displayName":"Colour 10 Value"},"overrideDimensionColor":{"type":{"fill":{"solid":{"color":true}}},"displayName":"Override Dimension Colour"},"borderDimensionColor":{"type":{"fill":{"solid":{"color":true}}},"displayName":"Border Dimension Colour"},"timelineDimensionColor":{"type":{"fill":{"solid":{"color":true}}},"displayName":"Timeline Dimension Colour"},"showData":{"type":{"bool":true},"displayName":"Show Values In Grid"},"showTotals":{"type":{"bool":true},"displayName":"Show Totals"},"totalsColor":{"type":{"fill":{"solid":{"color":true}}},"displayName":"Totals Colour"}}}}},"content":{"js":"/*\n *  Power BI Visual CLI\n *\n *  Copyright (c) Microsoft Corporation\n *  All rights reserved.\n *  MIT License\n *\n *  Permission is hereby granted, free of charge, to any person obtaining a copy\n *  of this software and associated documentation files (the \"\"Software\"\"), to deal\n *  in the Software without restriction, including without limitation the rights\n *  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n *  copies of the Software, and to permit persons to whom the Software is\n *  furnished to do so, subject to the following conditions:\n *\n *  The above copyright notice and this permission notice shall be included in\n *  all copies or substantial portions of the Software.\n *\n *  THE SOFTWARE IS PROVIDED *AS IS*, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n *  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n *  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n *  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n *  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n *  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n *  THE SOFTWARE.\n */\nvar powerbi;\n(function (powerbi) {\n    var extensibility;\n    (function (extensibility) {\n        var visual;\n        (function (visual) {\n            var PBI_CV_522F2011_DD5A_44D2_A8ED_456F3931DF77;\n            (function (PBI_CV_522F2011_DD5A_44D2_A8ED_456F3931DF77) {\n                var CrossTab = (function () {\n                    function CrossTab(options) {\n                        this.svgSize = { width: 800, height: 300 };\n                        this.dicColor = [];\n                        this.totalsColor = '#5E5E5E';\n                        this.overrideDimensionColor = '#FF6363';\n                        this.borderDimensionColor = '#FF6363';\n                        this.timelineDimensionColor = '#0033FF';\n                        //private margin: IMargin = { left: 10, right: 10, bottom: 15, top: 15 };\n                        this.margin = { left: 10, right: 10, bottom: 15, top: 15 };\n                        this.animationDuration = 1000;\n                        this.host = options.host;\n                        this.svgSize.height = options.element.clientHeight;\n                        this.svgSize.width = options.element.clientWidth;\n                        this.svgDiv = d3.select(options.element)\n                            .append('div')\n                            .attr(\"style\", \"overflow: auto\")\n                            .attr('class', 'crossTabContainer')\n                            .attr(\"style\", 'height:' + this.svgSize.height)\n                            .attr(\"style\", 'width:' + this.svgSize.width);\n                        this.svg = this.svgDiv\n                            .append('svg')\n                            .attr(\"class\", \"svgCrossTab\")\n                            .attr(\"height\", this.svgSize.height)\n                            .attr(\"width\", this.svgSize.width);\n                        this.selectionManager = options.host.createSelectionManager();\n                    }\n                    /*constructor(options: VisualConstructorOptions) {\n                        console.log('Visual constructor', options);\n                        this.target = options.element;\n                        this.updateCount = 0;\n                    }*/\n                    CrossTab.visualTransform = function (dataView, host, showTotals) {\n                        // no category - nothing to display\n                        if (!dataView\n                            || !dataView\n                            || !dataView.categorical\n                            || !dataView.categorical.categories\n                            || !dataView.categorical.categories[0].source\n                            || !dataView.categorical.values)\n                            return { datapoints: null };\n                        //var categoryValueFormatter: IValueFormatter;\n                        //var legendValueFormatter: IValueFormatter;\n                        var dataPoints = [];\n                        var catMetaData = dataView.metadata;\n                        var catTable = dataView.table;\n                        var catX = [];\n                        var catY = [];\n                        var data;\n                        var k, id, categoryX, categoryY, values;\n                        //var formatStringProp = CrossTab.Properties.general.formatString;\n                        var dataViewMetadata = dataView.metadata;\n                        var categorical = dataView.categorical;\n                        var category = categorical.categories[0];\n                        var dataValue = categorical.values[0];\n                        var dataMax;\n                        //fill X-Axis\n                        for (var i = 0; i < dataView.categorical.categories[0].values.length; i++) {\n                            catX.push(dataView.categorical.categories[0].values[i]);\n                        }\n                        //fill Y-Axis\n                        for (var i = 0; i < dataView.categorical.values.length; i++) {\n                            if (dataView.categorical.values[i].source && dataView.categorical.values[i].source.roles && dataView.categorical.values[i].source.roles['Values']) {\n                                //we are in a 'Values' object\n                                var yAxis = dataView.categorical.values[i].source.groupName;\n                                var xTotal = 0;\n                                //add Y Category\n                                catY.push(yAxis);\n                                //loop through the 'Values' measure to build dataPoints\n                                for (var j = 0; j < dataView.categorical.values[i].values.length; j++) {\n                                    //some values will be null or not exist. We still want to display a square so return as 0\n                                    var datapoint = {\n                                        categoryY: yAxis,\n                                        categoryX: catX[j],\n                                        overrideDimension: false,\n                                        borderDimension: false,\n                                        timelineDimension: false,\n                                        value: null,\n                                        //identity: host.createSelectionIdBuilder().withCategory(categorical.categories[0], i).withMeasure(dataView.categorical.values[i].source.queryName).withSeries(categorical.values, categorical.values[i]).createSelectionId(),\n                                        identity: host.createSelectionIdBuilder().withCategory(categorical.categories[0], j).withSeries(categorical.values, categorical.values[i]).withMeasure(dataView.categorical.values[i].source.queryName).createSelectionId(),\n                                        fill: null,\n                                        isTotal: false,\n                                        selected: false\n                                    };\n                                    if (dataView.categorical.values[i].values[j]) {\n                                        datapoint.value = dataView.categorical.values[i].values[j];\n                                    }\n                                    else {\n                                        datapoint.value = 0;\n                                    }\n                                    //add to the x-axis total for this row\n                                    xTotal += datapoint.value;\n                                    //the override dimension should replace the background colour. This can be used for a concept of 'late' or something else that should override the colour based on the supplied value. (Optional)\n                                    if (dataView.categorical.values[i + 1] && dataView.categorical.values[i + 1].values[j]) {\n                                        if (dataView.categorical.values[i + 1].values[j] === 1 && dataView.categorical.values[i + 1].source.groupName === dataView.categorical.values[i].source.groupName) {\n                                            if (dataView.categorical.values[i + 1].source.roles['OverrideDimension'] === true) {\n                                                datapoint.overrideDimension = true;\n                                            }\n                                            else if (dataView.categorical.values[i + 1].source.roles['BorderDimension'] === true) {\n                                                datapoint.borderDimension = true;\n                                            }\n                                            else if (dataView.categorical.values[i + 1].source.roles['TimelineDimension'] === true) {\n                                                datapoint.timelineDimension = true;\n                                            }\n                                        }\n                                    }\n                                    if (dataView.categorical.values[i + 2] && dataView.categorical.values[i + 2].values[j]) {\n                                        if (dataView.categorical.values[i + 2].values[j] === 1 && dataView.categorical.values[i + 2].source.groupName === dataView.categorical.values[i].source.groupName) {\n                                            if (dataView.categorical.values[i + 2].source.roles['OverrideDimension'] === true) {\n                                                datapoint.overrideDimension = true;\n                                            }\n                                            else if (dataView.categorical.values[i + 2].source.roles['BorderDimension'] === true) {\n                                                datapoint.borderDimension = true;\n                                            }\n                                            else if (dataView.categorical.values[i + 2].source.roles['TimelineDimension'] === true) {\n                                                datapoint.timelineDimension = true;\n                                            }\n                                        }\n                                    }\n                                    if (dataView.categorical.values[i + 3] && dataView.categorical.values[i + 3].values[j]) {\n                                        if (dataView.categorical.values[i + 3].values[j] === 1 && dataView.categorical.values[i + 3].source.groupName === dataView.categorical.values[i].source.groupName) {\n                                            if (dataView.categorical.values[i + 3].source.roles['OverrideDimension'] === true) {\n                                                datapoint.overrideDimension = true;\n                                            }\n                                            else if (dataView.categorical.values[i + 3].source.roles['BorderDimension'] === true) {\n                                                datapoint.borderDimension = true;\n                                            }\n                                            else if (dataView.categorical.values[i + 3].source.roles['TimelineDimension'] === true) {\n                                                datapoint.timelineDimension = true;\n                                            }\n                                        }\n                                    }\n                                    dataPoints.push(datapoint);\n                                }\n                                //add total datapoint at the end of the x-axis\n                                if (showTotals) {\n                                    dataPoints.push({\n                                        categoryY: yAxis,\n                                        categoryX: 'Total',\n                                        overrideDimension: false,\n                                        borderDimension: false,\n                                        timelineDimension: false,\n                                        value: Math.round(xTotal / dataView.categorical.values[i].values.length),\n                                        identity: null,\n                                        fill: null,\n                                        isTotal: true,\n                                        selected: false\n                                    });\n                                }\n                            }\n                        }\n                        if (showTotals) {\n                            var rowCount = 0;\n                            for (var j = 0; j < dataView.categorical.values.length; j++) {\n                                if (dataView.categorical.values[j].source.displayName === \"TaskPercentComplete\") {\n                                    rowCount++;\n                                }\n                            }\n                            for (var n = 0; n < dataView.categorical.values[0].values.length; n++) {\n                                var yTotal = 0;\n                                for (var i = 0; i < dataView.categorical.values.length; i++) {\n                                    if (dataView.categorical.values[i].source.displayName === \"TaskPercentComplete\") {\n                                        yTotal += dataView.categorical.values[i].values[n];\n                                    }\n                                }\n                                dataPoints.push({\n                                    categoryY: 'Total',\n                                    categoryX: dataView.categorical.categories[0].values[n],\n                                    overrideDimension: false,\n                                    borderDimension: false,\n                                    timelineDimension: false,\n                                    value: Math.round(yTotal / rowCount),\n                                    identity: null,\n                                    fill: null,\n                                    isTotal: true,\n                                    selected: false\n                                });\n                            }\n                        }\n                        if (showTotals) {\n                            catX.push('Total');\n                            catY.push('Total');\n                        }\n                        return {\n                            dataPoints: dataPoints,\n                            categoryX: catX.filter(function (n) { return n !== undefined; }),\n                            categoryY: catY.filter(function (n) { return n !== undefined; }),\n                        };\n                    };\n                    CrossTab.prototype.update = function (options) {\n                        if (!options.dataViews || !options.dataViews[0])\n                            return;\n                        this.svg.selectAll(\"*\").remove();\n                        this.mainGraphics = this.svg;\n                        this.setViewportSize(options.viewport);\n                        this.updateInternal(options);\n                        this.setSVGSize(options.viewport);\n                    };\n                    CrossTab.prototype.updateInternal = function (options) {\n                        var dataView = this.dataView = options.dataViews[0];\n                        var showTotals = this.getShowTotals(options.dataViews[0]);\n                        var totalsColor = this.totalsColor = this.getTotalsColor(dataView);\n                        var overrideDimensionColor = this.overrideDimensionColor = this.getOverrideDimensionColor(dataView);\n                        var borderDimensionColor = this.borderDimensionColor = this.getBorderDimensionColor(dataView);\n                        var timelineDimensionColor = this.timelineDimensionColor = this.getTimelineDimensionColor(dataView);\n                        var chartData = this.chartData = CrossTab.visualTransform(dataView, this.host, showTotals);\n                        //var suppressAnimations = Boolean(options.suppressAnimations);\n                        if (chartData.dataPoints) {\n                            var minDataValue = d3.min(chartData.dataPoints, function (d) { return d.value; });\n                            var maxDataValue = d3.max(chartData.dataPoints, function (d) { return d.value; });\n                            //calculate the max length of the categoryX/Y columns as we cannot compute the width until after it's rendered\n                            var categoryXTextLength = 1, categoryYTextLength = 1, categoryXTextWidth = 10, categoryYTextWidth = 10;\n                            var showLegend = this.getShowLegend(dataView);\n                            var gridSizeWidth = 28, gridSizeHeight = 28;\n                            var legendElementWidth = gridSizeWidth;\n                            var legendElementHeight = gridSizeHeight / 2;\n                            var xOffset = gridSizeWidth + this.margin.left;\n                            var yOffset = this.margin.bottom;\n                            var dicColor = this.dicColor = [];\n                            this.getColors(dataView);\n                            this.mainGraphics.selectAll(\".categoryYLabel\")\n                                .data(chartData.categoryY)\n                                .enter().append(\"text\")\n                                .text(function (d) {\n                                return d;\n                            })\n                                .attr(\"dy\", \"1.1em\")\n                                .attr(\"x\", this.margin.left)\n                                .attr(\"y\", function (d, i) {\n                                return (i * gridSizeHeight + (yOffset) / 2.5) + categoryYTextWidth;\n                            })\n                                .style(\"text-anchor\", \"end\")\n                                .attr(\"transform\", \"translate(40,\" + gridSizeHeight + \")\")\n                                .attr(\"class\", \"categoryYLabel mono axis\")\n                                .style(\"font-size\", \"6pt\");\n                            //this.mainGraphics.selectAll(\".categoryYLabel\")\n                            //     .call(this.wrap, gridSizeWidth);\n                            this.mainGraphics.selectAll(\".categoryYLabel\")\n                                .each(function () { categoryXTextWidth = Math.max(categoryXTextWidth, this.getComputedTextLength()); });\n                            this.mainGraphics.selectAll(\".categoryXLabel\")\n                                .data(chartData.categoryX)\n                                .enter().append(\"text\")\n                                .text(function (d) {\n                                return d;\n                            })\n                                .attr(\"transform\", function (d, i) {\n                                var deg = -90;\n                                var cx = this.getComputedTextLength() / 2;\n                                var cy = 20;\n                                return \"translate(\" + (xOffset + categoryXTextWidth + ((i + 1) * gridSizeWidth)) + \", \" + categoryYTextWidth + \")rotate(\" + deg + \",\" + 0 + \",\" + yOffset + \")\";\n                            })\n                                .style(\"text-anchor\", \"start\")\n                                .attr(\"startOffset\", \"100%\")\n                                .attr(\"dy\", \"-.5em\")\n                                .attr(\"class\", \"categoryXLabel mono axis\");\n                            //this.truncateTextIfNeeded(this.mainGraphics.selectAll(\".categoryXLabel\"), 200);\n                            //calculate categoryYTextWidth\n                            this.mainGraphics.selectAll(\".categoryXLabel\")\n                                .each(function () { categoryYTextWidth = Math.max(categoryYTextWidth, this.getComputedTextLength()); });\n                            //re-apply categoryYTextWidth to CategoryYLabel\n                            this.mainGraphics.selectAll(\".categoryYLabel\")\n                                .attr(\"y\", function (d, i) {\n                                return (i * gridSizeHeight + (yOffset) / 2.5) + categoryYTextWidth;\n                            });\n                            //re-apply categoryYTextWidth to categoryXLabel\n                            this.mainGraphics.selectAll(\".categoryXLabel\")\n                                .attr(\"transform\", function (d, i) {\n                                return \"translate(\" + (xOffset + categoryXTextWidth + ((i + 1) * gridSizeWidth)) + \", \" + categoryYTextWidth + \")rotate(\" + \"-90\" + \",\" + 0 + \",\" + yOffset + \")\";\n                            });\n                            //we need to wait until we have computed the category axis text widths before setting the svg size:\n                            this.svgSize.width = (gridSizeWidth * (chartData.categoryX.length + 1)) + categoryXTextWidth;\n                            this.svgSize.height = (gridSizeHeight * (chartData.categoryY.length + 1)) + categoryYTextWidth;\n                            if (showLegend) {\n                                this.svgSize.height += gridSizeHeight + yOffset * 2;\n                            }\n                            var selectionManager = this.selectionManager;\n                            var crosstab = this.mainGraphics.selectAll(\".categoryX\")\n                                .data(chartData.dataPoints)\n                                .enter().append(\"rect\")\n                                .attr(\"x\", function (d, i) { return (chartData.categoryX.indexOf(d.categoryX) * gridSizeWidth + xOffset) + (categoryXTextWidth - 10); })\n                                .attr(\"y\", function (d, i) { return ((chartData.categoryY.indexOf(d.categoryY) + 0.5) * gridSizeHeight + yOffset) + categoryYTextWidth; })\n                                .attr(\"class\", \"categoryX bordered\")\n                                .attr(\"width\", gridSizeWidth - 1)\n                                .attr(\"height\", gridSizeHeight - 1)\n                                .attr(\"rx\", 4)\n                                .attr(\"ry\", 4)\n                                .style(\"stroke\", function (d, i) {\n                                return d.borderDimension == true ? borderDimensionColor : 'White';\n                            })\n                                .style(\"stroke-width\", 1)\n                                .style(\"fill\", '#E8E8E8');\n                            var currentX = 0, currentY = 0;\n                            var crosstab3 = this.mainGraphics.selectAll(\".timelineDimension\")\n                                .data(chartData.dataPoints)\n                                .enter()\n                                .append(\"line\")\n                                .attr(\"visibility\", function (d, i) {\n                                return d.timelineDimension == true ? \"visible\" : \"hidden\";\n                            })\n                                .style(\"stroke\", function (d, i) { return timelineDimensionColor; }) // colour the line\n                                .attr(\"stroke-width\", function (d, i) { return 4; })\n                                .attr(\"x1\", function (d, i) { return ((chartData.categoryX.indexOf(d.categoryX) * gridSizeWidth + xOffset) + (categoryXTextWidth - 10)) + 28; }) // x position of the first end of the line\n                                .attr(\"y1\", function (d, i) { return ((chartData.categoryY.indexOf(d.categoryY) + 0.5) * gridSizeHeight + yOffset) + categoryYTextWidth; }) // y position of the first end of the line\n                                .attr(\"x2\", function (d, i) { return ((chartData.categoryX.indexOf(d.categoryX) * gridSizeWidth + xOffset) + (categoryXTextWidth - 10)) + 28; }) // x position of the second end of the line\n                                .attr(\"y2\", function (d, i) { return (((chartData.categoryY.indexOf(d.categoryY) + 0.5) * gridSizeHeight + yOffset) + categoryYTextWidth) + 28; });\n                            d3.selectAll(\"line[visibility=hidden]\").remove();\n                            function getColor(val, isTotal, overrideDimension, borderDimension, timelineDimension) {\n                                if (overrideDimension) {\n                                    return overrideDimensionColor;\n                                }\n                                else if (isTotal) {\n                                    return totalsColor;\n                                }\n                                else if (dicColor[val]) {\n                                    return dicColor[val].solid.color;\n                                }\n                                else {\n                                    return '#E8E8E8';\n                                }\n                            }\n                            var elementAnimation = this.getAnimationMode(crosstab, true);\n                            elementAnimation.style(\"fill\", function (d) { return getColor(d.value, d.isTotal, d.overrideDimension, d.borderDimension, d.timelineDimension); });\n                            var crosstab1 = this.mainGraphics.selectAll(\".categoryX\")\n                                .on('mouseover', function (d) {\n                                d3.select(this).transition()\n                                    .ease(\"elastic\")\n                                    .duration(1000)\n                                    .attr(\"rx\", 8)\n                                    .attr('ry', 8);\n                                mouseover(d.categoryX, d.categoryY);\n                                d3.event.stopPropagation();\n                            })\n                                .on('mouseout', function (d) {\n                                d3.select(this).transition()\n                                    .ease(\"elastic\")\n                                    .duration(1000)\n                                    .attr(\"rx\", 4)\n                                    .attr('ry', 4);\n                                mouseout();\n                                d3.event.stopPropagation();\n                            })\n                                .on('click', function (d) {\n                                var _this = this;\n                                if (d.selected && !d.isTotal) {\n                                    d3.selectAll(\".categoryX\").style('opacity', 1);\n                                    d.selected = false;\n                                    selectionManager.clear();\n                                }\n                                else if (!d.selected && !d.isTotal) {\n                                    d3.selectAll(\".categoryX\").style('opacity', 0.6);\n                                    selectionManager.select(d.identity).then(function (ids) { return d3.select(_this).style('opacity', 1); });\n                                    d.selected = true;\n                                }\n                                d3.event.stopPropagation();\n                            });\n                            function mouseover(categoryX, categoryY) {\n                                d3.selectAll(\".categoryXLabel\").classed(\"active\", function (d, i) { return d == categoryX; });\n                                d3.selectAll(\".categoryYLabel\").classed(\"active\", function (d, i) { return d == categoryY; });\n                            }\n                            function mouseout() {\n                                d3.selectAll(\"text\").classed(\"active\", false);\n                            }\n                            var showDataInRect = this.getShowData(dataView);\n                            if (showDataInRect) {\n                                this.mainGraphics.selectAll(\".rectValue\")\n                                    .data(chartData.dataPoints)\n                                    .enter().append(\"text\")\n                                    .attr(\"x\", function (d, i) { return (chartData.categoryX.indexOf(d.categoryX) * gridSizeWidth + xOffset) + categoryXTextWidth - 25; })\n                                    .attr(\"y\", function (d, i) { return ((chartData.categoryY.indexOf(d.categoryY) + 0.75) * gridSizeHeight + yOffset) + categoryYTextWidth - 2; })\n                                    .attr(\"dy\", \"1.81em\")\n                                    .style(\"text-anchor\", \"middle\")\n                                    .style(\"fill\", \"White\")\n                                    .attr(\"class\", \"rectValue mono axis bar-text\")\n                                    .attr(\"transform\", \"translate(\" + gridSizeHeight + \", -6)\")\n                                    .text(function (d) {\n                                    if (d.value) {\n                                        return d.value.toString(); //.substring(0,1)\n                                    }\n                                    else {\n                                        return null;\n                                    }\n                                });\n                            }\n                            else {\n                                crosstab.append(\"title\").text(function (d) {\n                                    //return valueFormatter.create({ value: Number(d.value) }).format(Number(d.value));\n                                });\n                            }\n                            var showLegend = this.getShowLegend(dataView);\n                            if (showLegend) {\n                            }\n                        }\n                    };\n                    /*public getColor(val) :string {\n                        if(val) {\n                            if (val < 5) {\n                                return 'Blue';\n                            } else if (val < 10) {\n                                return 'Orange';\n                            } else if (val < 20) {\n                                return 'Red';\n                            }\n                        }\n                        return '#000';\n                    }*/\n                    CrossTab.prototype.setViewportSize = function (viewport) {\n                        var height, width;\n                        height =\n                            viewport.height -\n                                this.margin.top -\n                                this.margin.bottom;\n                        width =\n                            viewport.width -\n                                this.margin.left -\n                                this.margin.right;\n                        this.viewport = {\n                            height: height,\n                            width: width\n                        };\n                        this.mainGraphics\n                            .attr(\"height\", Math.max(this.viewport.height + this.margin.top, 0))\n                            .attr(\"width\", Math.max(this.viewport.width + this.margin.left, 0));\n                        //this.mainGraphics.attr(\"transform\", SVGUtil.translate(this.margin.left, this.margin.top));\n                    };\n                    CrossTab.prototype.setSVGSize = function (viewport) {\n                        this.svg\n                            .attr(\"height\", this.svgSize.height)\n                            .attr(\"width\", this.svgSize.width);\n                        this.svgDiv\n                            .attr(\"style\", \"overflow: auto; height:\" + viewport.height + \"px; width:\" + viewport.width + \"px;\");\n                    };\n                    CrossTab.prototype.truncateTextIfNeeded = function (text, width) {\n                        /*text.call(AxisHelper.LabelLayoutStrategy.clip,\n                            width,\n                            TextMeasurementService.svgEllipsis);*/\n                    };\n                    /*private wrap(text, width): void {\n                        text.each(function () {\n                            var text = d3.select(this);\n                            var words = text.text().split(/\\s+/).reverse();\n                            var word;\n                            var line = [];\n                            var lineNumber = 0;\n                            var lineHeight = 1.1; // ems\n                            var x = text.attr(\"x\");\n                            var y = text.attr(\"y\");\n                            var dy = parseFloat(text.attr(\"dy\"));\n                            var tspan = text.text(null).append(\"tspan\").attr(\"x\", x).attr(\"y\", y).attr(\"dy\", dy + \"em\");\n                            while (word = words.pop()) {\n                                line.push(word);\n                                tspan.text(line.join(\" \"));\n                                var tspannode: any = tspan.node();  //Fixing Typescript error: Property 'getComputedTextLength' does not exist on type 'Element'.\n                                if (tspannode.getComputedTextLength() > width) {\n                                    line.pop();\n                                    tspan.text(line.join(\" \"));\n                                    line = [word];\n                                    tspan = text.append(\"tspan\").attr(\"x\", x).attr(\"y\", y).attr(\"dy\", ++lineNumber * lineHeight + dy + \"em\").text(word);\n                                }\n                            }\n                        });\n                    }*/\n                    CrossTab.prototype.getAnimationMode = function (element, suppressAnimations) {\n                        if (suppressAnimations) {\n                            return element;\n                        }\n                        return element.transition().duration(this.animationDuration);\n                    };\n                    CrossTab.prototype.getColors = function (dataView) {\n                        if (dataView) {\n                            var objects = dataView.metadata.objects;\n                            if (objects) {\n                                var general = objects['general'];\n                                if (general) {\n                                    for (var i = 0; i <= 10; i++) {\n                                        if (general['color' + i] && general['color' + i + 'Val']) {\n                                            this.dicColor[general['color' + i + 'Val']] = general['color' + i];\n                                        }\n                                    }\n                                }\n                            }\n                        }\n                    };\n                    CrossTab.prototype.getColor = function (dataView, colorNum) {\n                        if (dataView) {\n                            var objects = dataView.metadata.objects;\n                            if (objects) {\n                                var general = objects['general'];\n                                if (general) {\n                                    if (general['color' + colorNum]) {\n                                        return general['color' + colorNum];\n                                    }\n                                }\n                            }\n                        }\n                        return null;\n                    };\n                    CrossTab.prototype.getTotalsColor = function (dataView) {\n                        if (dataView) {\n                            var objects = dataView.metadata.objects;\n                            if (objects) {\n                                var general = objects['general'];\n                                if (general) {\n                                    if (general['totalsColor']) {\n                                        return general['totalsColor'].solid.color;\n                                    }\n                                }\n                            }\n                        }\n                        return '#5E5E5E';\n                    };\n                    CrossTab.prototype.getOverrideDimensionColor = function (dataView) {\n                        if (dataView) {\n                            var objects = dataView.metadata.objects;\n                            if (objects) {\n                                var general = objects['general'];\n                                if (general) {\n                                    if (general['overrideDimensionColor']) {\n                                        return general['overrideDimensionColor'].solid.color;\n                                    }\n                                }\n                            }\n                        }\n                        return '#FF6363';\n                    };\n                    CrossTab.prototype.getBorderDimensionColor = function (dataView) {\n                        if (dataView) {\n                            var objects = dataView.metadata.objects;\n                            if (objects) {\n                                var general = objects['general'];\n                                if (general) {\n                                    if (general['borderDimensionColor']) {\n                                        return general['borderDimensionColor'].solid.color;\n                                    }\n                                }\n                            }\n                        }\n                        return '#FF6363';\n                    };\n                    CrossTab.prototype.getTimelineDimensionColor = function (dataView) {\n                        if (dataView) {\n                            var objects = dataView.metadata.objects;\n                            if (objects) {\n                                var general = objects['general'];\n                                if (general) {\n                                    if (general['timelineDimensionColor']) {\n                                        return general['timelineDimensionColor'].solid.color;\n                                    }\n                                }\n                            }\n                        }\n                        return '#FF6363';\n                    };\n                    CrossTab.prototype.getColorVal = function (dataView, colorNum) {\n                        if (dataView) {\n                            var objects = dataView.metadata.objects;\n                            if (objects) {\n                                var general = objects['general'];\n                                if (general) {\n                                    if (general['color' + colorNum + 'Val']) {\n                                        return general['color' + colorNum + 'Val'];\n                                    }\n                                }\n                            }\n                        }\n                        return null;\n                    };\n                    CrossTab.prototype.getLegendVal = function (dataView, colorNum) {\n                        if (dataView) {\n                            var objects = dataView.metadata.objects;\n                            if (objects) {\n                                var general = objects['general'];\n                                if (general) {\n                                    if (general['color' + colorNum + 'LegendVal']) {\n                                        return general['color' + colorNum + 'LegendVal'];\n                                    }\n                                }\n                            }\n                        }\n                        return null;\n                    };\n                    CrossTab.prototype.getShowData = function (dataView) {\n                        if (dataView) {\n                            var objects = dataView.metadata.objects;\n                            if (objects) {\n                                var general = objects['general'];\n                                if (general) {\n                                    return general['showData'];\n                                }\n                            }\n                        }\n                        return false;\n                    };\n                    CrossTab.prototype.getShowLegend = function (dataView) {\n                        if (dataView) {\n                            var objects = dataView.metadata.objects;\n                            if (objects) {\n                                var general = objects['general'];\n                                if (general) {\n                                    return general['showLegend'];\n                                }\n                            }\n                        }\n                        return false;\n                    };\n                    CrossTab.prototype.getShowTotals = function (dataView) {\n                        if (dataView) {\n                            var objects = dataView.metadata.objects;\n                            if (objects) {\n                                var general = objects['general'];\n                                if (general) {\n                                    return general['showTotals'];\n                                }\n                            }\n                        }\n                        return false;\n                    };\n                    CrossTab.prototype.enumerateObjectInstances = function (options) {\n                        var instances = [];\n                        var dataView = this.dataView;\n                        var objectName = options.objectName;\n                        switch (options.objectName) {\n                            case 'general':\n                                instances.push({\n                                    objectName: 'general',\n                                    displayName: 'General',\n                                    selector: null,\n                                    properties: {\n                                        color1: this.getColor(dataView, '1'),\n                                        color1Val: this.getColorVal(dataView, '1'),\n                                        //color1LegendVal:this.getLegendVal(dataView, '1'),\n                                        color2: this.getColor(dataView, '2'),\n                                        color2Val: this.getColorVal(dataView, '2'),\n                                        //color2LegendVal:this.getLegendVal(dataView, '2'),\n                                        color3: this.getColor(dataView, '3'),\n                                        color3Val: this.getColorVal(dataView, '3'),\n                                        //color3LegendVal:this.getLegendVal(dataView, '3'),\n                                        color4: this.getColor(dataView, '4'),\n                                        color4Val: this.getColorVal(dataView, '4'),\n                                        //color4LegendVal:this.getLegendVal(dataView, '4'),\n                                        color5: this.getColor(dataView, '5'),\n                                        color5Val: this.getColorVal(dataView, '5'),\n                                        //color5LegendVal:this.getLegendVal(dataView, '5'),\n                                        color6: this.getColor(dataView, '6'),\n                                        color6Val: this.getColorVal(dataView, '6'),\n                                        color7: this.getColor(dataView, '7'),\n                                        color7Val: this.getColorVal(dataView, '7'),\n                                        color8: this.getColor(dataView, '8'),\n                                        color8Val: this.getColorVal(dataView, '8'),\n                                        color9: this.getColor(dataView, '9'),\n                                        color9Val: this.getColorVal(dataView, '9'),\n                                        color10: this.getColor(dataView, '10'),\n                                        color10Val: this.getColorVal(dataView, '10'),\n                                        overrideDimensionColor: this.getOverrideDimensionColor(dataView),\n                                        borderDimensionColor: this.getBorderDimensionColor(dataView),\n                                        timelineDimensionColor: this.getTimelineDimensionColor(dataView),\n                                        showData: this.getShowData(dataView),\n                                        showLegend: this.getShowLegend(dataView),\n                                        showTotals: this.getShowTotals(dataView),\n                                        totalsColor: this.getTotalsColor(dataView)\n                                    }\n                                });\n                                break;\n                            case 'dataPoint':\n                                if (this.dataView /*&& !GradientUtils.hasGradientRole(this.dataView.categorical)*/)\n                                    this.enumerateDataPoints(instances, options);\n                                break;\n                        }\n                        return instances;\n                    };\n                    CrossTab.prototype.enumerateDataPoints = function (instances, options) {\n                        var data = this.chartData;\n                        if (!data)\n                            return;\n                        var dicInstanceValues = [];\n                        var seriesCount = data.dataPoints.length;\n                        /*enumeration.pushInstance({\n                            objectName: 'dataPoint',\n                            selector: null,\n                            properties: {\n                                defaultColor: { solid: { color: data.defaultDataPointColor || this.colors.getColorByIndex(0).value } }\n                            }\n                        }).pushInstance({\n                            objectName: 'dataPoint',\n                            selector: null,\n                            properties: {\n                                showAllDataPoints: !!data.showAllDataPoints\n                            }\n                        });\n                        for (var i = 0; i < seriesCount; i++) {\n                            var seriesDataPoints = data.dataPoints[i];\n                            if (seriesDataPoints.value !== undefined || seriesDataPoints.value !== null) {\n                                if (!(this.dicColor[seriesDataPoints.value])) {\n                                    //add it to colors\n                                    this.dicColor[seriesDataPoints.value] = (seriesDataPoints.fill) ? seriesDataPoints.fill : '#E8E8E8';\n                                }\n    \n                                if (!(dicInstanceValues[seriesDataPoints.value])) {\n                                    instances.push({\n                                        objectName: 'dataPoint',\n                                        displayName: seriesDataPoints.value.toString(),\n                                        selector: visuals.ColorHelper.normalizeSelector(seriesDataPoints.identity.getSelector()),\n                                        properties: {\n                                            fill: { solid: { color: seriesDataPoints.fill } }\n                                        },\n                                    });\n                                    dicInstanceValues[seriesDataPoints.value] = seriesDataPoints.fill;\n                                }\n    \n    \n                            }\n    \n                        }*/\n                    };\n                    CrossTab.Properties = {\n                        general: {},\n                        dataPoint: {\n                            defaultColor: {\n                                objectName: 'dataPoint',\n                                propertyName: 'defaultColor' },\n                            fill: {\n                                objectName: 'dataPoint',\n                                propertyName: 'fill'\n                            },\n                            value: {\n                                objectName: 'dataPoint',\n                                propertyName: 'value'\n                            }\n                        },\n                        labels: {\n                            labelPrecision: {\n                                objectName: \"labels\",\n                                propertyName: \"labelPrecision\"\n                            }\n                        }\n                    };\n                    return CrossTab;\n                }());\n                PBI_CV_522F2011_DD5A_44D2_A8ED_456F3931DF77.CrossTab = CrossTab;\n            })(PBI_CV_522F2011_DD5A_44D2_A8ED_456F3931DF77 = visual.PBI_CV_522F2011_DD5A_44D2_A8ED_456F3931DF77 || (visual.PBI_CV_522F2011_DD5A_44D2_A8ED_456F3931DF77 = {}));\n        })(visual = extensibility.visual || (extensibility.visual = {}));\n    })(extensibility = powerbi.extensibility || (powerbi.extensibility = {}));\n})(powerbi || (powerbi = {}));\nvar powerbi;\n(function (powerbi) {\n    var visuals;\n    (function (visuals) {\n        var plugins;\n        (function (plugins) {\n            plugins.PBI_CV_522F2011_DD5A_44D2_A8ED_456F3931DF77_DEBUG = {\n                name: 'PBI_CV_522F2011_DD5A_44D2_A8ED_456F3931DF77_DEBUG',\n                displayName: 'CrossTab',\n                class: 'CrossTab',\n                version: '1.0.0',\n                apiVersion: '1.1.0',\n                create: function (options) { return new powerbi.extensibility.visual.PBI_CV_522F2011_DD5A_44D2_A8ED_456F3931DF77.CrossTab(options); },\n                custom: true\n            };\n        })(plugins = visuals.plugins || (visuals.plugins = {}));\n    })(visuals = powerbi.visuals || (powerbi.visuals = {}));\n})(powerbi || (powerbi = {}));\n//# sourceMappingURL=visual.js.map","css":".visual-PBI_CV_522F2011_DD5A_44D2_A8ED_456F3931DF77_DEBUG text.mono {\n  font-size: 8pt!important;\n  font-family: Consolas, courier;\n  fill: #000;\n}\n.visual-PBI_CV_522F2011_DD5A_44D2_A8ED_456F3931DF77_DEBUG text.active {\n  fill: red;\n}\n.visual-PBI_CV_522F2011_DD5A_44D2_A8ED_456F3931DF77_DEBUG .bar-text {\n  pointer-events: none;\n}\n","iconBase64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OTY0NDA5REI1NDdGMTFFNjk5OTI4MUY2MTZDOThGRDkiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OTY0NDA5REM1NDdGMTFFNjk5OTI4MUY2MTZDOThGRDkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo5NjQ0MDlEOTU0N0YxMUU2OTk5MjgxRjYxNkM5OEZEOSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5NjQ0MDlEQTU0N0YxMUU2OTk5MjgxRjYxNkM5OEZEOSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PhvEah8AAAMXSURBVHjapJRNalxHFIVP/byf7rbith3kGCECIZnYEMjESzCZewXZQ0YZeBMZZBWeGLwQDwLGBOMQYhGiFi3ptd5P/eXc+1px4qEs8ah+Vd1fnXvPqTJPnz07PLp372nbNA0+4W8Yx/HPzea5n0Jov3/8+IcvHzy4j1JuRjMGv5+c/PXLixcvfYixfHN8fPz10dEXn6Kw9r4Wli8pidxJJn/6DdhSZQgFtWMZMcOZgpQyRL38h1hQ2YI+cI3jHWvw83cHGKZxEpbNORt+3Qhwy4pXtwx2hLSrhMkV+CYj1xmpSjB1RG8jqnbCJSKaxYRNTKowFxhh+URq3vdO1t5fFHzrBjwsEZ2P8NYiuYRCNZa9GuqA1lfomh7LqkVeXFD3WhnC8lmAOc99oKL1quAR557cBc76hMZbhKQVs08WXZ9xe1XhdNvh/t0Gf/wtQChDWKJQpCJxduIPd72UHLG5CricIhxpieulzAqZCoy5w45r+fxSR1nXhyxRqLXHTLqxWDZsenJoKoOeu9A9tiIp0Dun47JtMRC84tj1vcLUCwFK3UnqV5WWzhpEcTrNOwdZ3wPlEfhImMwJdK6ufOhhnE0xKUsn5FHDcf2mn1nq/97/kz/5PIspJmoPQzDzRJbA00GAyVB3pWeWo9MMgrmzMHykdFmr2A7ZXhUKgyyfYiRwNoY5xsXI+CAzqNPcO52fTREgTwOuhkHXdvv+XfdQWArMLDdwsrLAZ0ugmhzausZQAqPkmK09cG/KrcVCwQerlUIFrmAFzi9GvjjyWL2/pDGWkekHPXrTPmOyLuUGGiEAqWBzfo6J4DKbamZTWLe6R5XeGxyugaavcLCwyDziovA6NtKzHcs9WC7V1c/Xa82ltETeheV3XWcZESt+LXPE2RlBfsJZ16PnWTRs/r8KqVZi1I+jRufk9FTfxU1uaoXlz7db651vFtz1x6MryCk0pqYtNRYfRQT7UClcorRvw5I9pfONsvq3b+tXr1+fUnbgNXaju5C3vfn1zZutsIxx7rBY+xVj7rjtza5suTmcC4zLu38EGACbjHoFTqPiOgAAAABJRU5ErkJggg=="}}